---
title: vue的v-model和基于数据劫持的双向绑定
tags: 前端
---

### 背景
昨天在写代码的时候用到了v-model,出现了一点问题。我在vue的data中定义了一个空的对象`obj: {}`,在某个ajax操作中会对这个对象进行操作，赋予很多属性，比如说 `obj.name = 'lrq'`。在html中我将这个属性绑定在一个input输入框中`<input v-model="obj,name">`，但是没有达到想要的效果，前端页面既没有显示数据，console打印出来的数据也是空。**解决方案**：在定义obj对象的时候要直接加上这个属性，就可以监听到变化了。 `obj: {name: ''}`.借着这个机会深入了解一下vue的双向绑定。

### 什么是双向绑定?

v-model实现的功能就是双向绑定，前端页面的dom元素和js中的数据进行绑定。当前端元素，比如说是一个input输入框，内容发生改变后，相应的js中与之相关的数据也会发生改变。同理，当js中处理一些业务逻辑后，对数据进行了修改，前端页面中的input输入框的内容也会发生变化。这就是双向绑定。

### 双向绑定是怎么实现的?

1. dom元素内容发生变化，会触发相应的事件。比如说input元素的`onchange`、`oninput`事件，可以在事件中进行js中数据的同步修改。
2. 而js中的数据修改之后，怎么反映到dom元素中呢?这里用到了数据劫持。非常细节的底层现在我也还不是很懂，但大概的流程基本知道了。首先在初始化数据的时候要使用Object.defineProperty()方法重写数据的set和get方法，在实际的使用中，给数据赋值实际上就是调用了set方法，这样就可以在set方法中进行一些操作，比如说把set后的value直接写到前端的页面中，进而达到js中数据改变关联到前端页面同步改变的效果。

### v-model的语法糖
v-model相当于是一个语法糖，比如以下代码

```
<input type="text" v-model="suger">

<input type="text" v-bind:value="suger"  v-on:input="$event.target.value">
```
这两段代码产生的效果是一样的，这就是语法糖的意思。

### 需要进一步了解的东西
看了很多博客，说是在数据劫持中使用了发布者订阅者模式，具体的看了一些还是不太清晰，日后再好好看一下，再回来补充。